{"version":3,"file":"applytsks.min.js","sources":["../src/applytsks.js"],"sourcesContent":["define([\n  'core/modal',\n  'core/modal_factory',\n  'core/modal_events',\n  'core/templates',\n  'core/str',\n  'core/ajax',\n  'jquery',\n  'core/notification'\n], function(Modal, ModalFactory, ModalEvents, Templates, Str, Ajax, $, Notification) {\n\n  var toArray = function(nl) { return Array.prototype.slice.call(nl || []); };\n  var MAP = { tasks: 'tasks', skills: 'skills', knowledge: 'knowledge' };\n\n  var getModalAPI = function() {\n    var hasNew = Modal && typeof Modal.create === 'function';\n    return {\n      create: hasNew ? Modal.create.bind(Modal)\n        : (ModalFactory && ModalFactory.create.bind(ModalFactory)),\n      types: (hasNew && (Modal.types || Modal.TYPE)) ||\n        (ModalFactory && ModalFactory.types) ||\n        null\n    };\n  };\n\n  var extractFromResponse = function(root) {\n    var out = { tasks: [], skills: [], knowledge: [] };\n    if (!root) { return out; }\n    var dl = root.querySelector('dl');\n    if (!dl) { return out; }\n\n    toArray(dl.querySelectorAll('dt')).forEach(function(dt) {\n      var key = MAP[(dt.textContent || '').trim().toLowerCase()];\n      if (!key) { return; }\n      var dd = dt.nextElementSibling;\n      if (!dd || dd.tagName.toLowerCase() !== 'dd') { return; }\n\n      out[key] = toArray(dd.querySelectorAll('li'))\n        .map(function(li) { return (li.innerText || '').trim(); })\n        .filter(Boolean)\n        .filter(function(s) { return s.toLowerCase() !== 'none'; });\n    });\n    return out;\n  };\n\n  var collectChecked = function(root) {\n    var pick = function(section) {\n      var sel = '.aiplacement-applytsks-section[data-section=\"' + section + '\"] input[type=\"checkbox\"]:checked';\n      return toArray(root.querySelectorAll(sel)).map(function(cb) {\n        var row = cb.closest('label');\n        var span = row && row.querySelector('span');\n        return span ? span.textContent.trim() : null;\n      }).filter(Boolean);\n    };\n    return { tasks: pick('tasks'), skills: pick('skills'), knowledge: pick('knowledge') };\n  };\n\n  var attachControls = function($root) {\n    $root.on('click', '[data-action=\"selectall\"]', function(e) {\n      e.preventDefault();\n      var sec = e.currentTarget.closest('.aiplacement-applytsks-section');\n      if (sec) {\n        toArray(sec.querySelectorAll('input[type=\"checkbox\"]')).forEach(function(cb) { cb.checked = true; });\n      }\n    });\n    $root.on('click', '[data-action=\"clearall\"]', function(e) {\n      e.preventDefault();\n      var sec = e.currentTarget.closest('.aiplacement-applytsks-section');\n      if (sec) {\n        toArray(sec.querySelectorAll('input[type=\"checkbox\"]')).forEach(function(cb) { cb.checked = false; });\n      }\n    });\n\n    $root.on('click', '[data-action=\"apply-inline\"]', function(e) {\n      e.preventDefault();\n      $root.trigger(ModalEvents.save);\n    });\n  };\n\n  // Get course id from activity body\n  var getCourseIdFromBody = function() {\n    var cls = (document.body && document.body.className) || '';\n    var m = cls.match(/(?:^|\\s)course-(\\d+)(?:\\s|$)/);\n    return m ? parseInt(m[1], 10) : null;\n  };\n\n  // Add user selected competencies from the modal to the course\n  var addCompetenciesToCourse = function(courseId, competencyIds) {\n    if (!courseId || !Array.isArray(competencyIds) || competencyIds.length === 0) {\n      return Promise.resolve([]);\n    }\n\n    var calls = competencyIds.map(function(id) {\n      return {\n        methodname: 'core_competency_add_competency_to_course',\n        args: { courseid: courseId, competencyid: id }\n      };\n    });\n\n    var reqs = Ajax.call(calls);\n\n    return Promise.all(reqs.map(function(p, idx) {\n      return Promise.resolve(p)\n        .then(function(res) { return { id: competencyIds[idx], result: res }; })\n        .catch(function(err) { return { id: competencyIds[idx], error: err }; });\n    }));\n  };\n\n  // Escape text for safe HTML output\n  var esc = function (s) {\n    return String(s)\n      .replace(/&/g, '&amp;').replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#39;');\n  };\n\n  // Render a bullet list from an array of strings.\n  var renderList = function (items) {\n    return '<ul class=\"mb-0 mt-1\">' +\n      items.map(function (t) { return '<li>' + esc(t) + '</li>'; }).join('') +\n    '</ul>';\n  };\n\n  var norm = function(s) {\n    return (s === null || s === undefined ? '' : String(s)).toLowerCase().trim();\n  };\n\n  // Matches the competencies selected from the modal with the system's competencies\n  var matchPickedToCompetencies = function(frameworkId, picked) {\n    return new Promise(function(resolve, reject) {\n      var calls = Ajax.call([{\n        methodname: 'core_competency_list_competencies',\n        args: {\n          filters: [\n            { column: 'competencyframeworkid', value: String(frameworkId) }\n          ],\n          sort: 'shortname',\n          order: 'ASC',\n          skip: 0,\n          limit: 0\n        }\n      }]);\n\n      calls[0].done(function(response) {\n        var list = Array.isArray(response) ? response : (response.competencies || []);\n        var byIdnumber = new Map();\n        var byShortExact = new Map();\n        list.forEach(function(c) {\n          var idn = norm(c.idnumber);\n          var sn = norm(c.shortname);\n          if (idn) { byIdnumber.set(idn, c); }\n          if (sn) { byShortExact.set(sn, c); }\n        });\n\n        var inputs = []\n          .concat(picked.tasks || [])\n          .concat(picked.skills || [])\n          .concat(picked.knowledge || []);\n\n        var matches = inputs.map(function(str) {\n          var original = str || '';\n          var parts = original.split(' - ');\n          var code = norm(parts[0] || '');\n          var name = norm(parts.slice(1).join(' - '));\n          var comp = null;\n\n          // Get idnumber\n          if (code && byIdnumber.has(code)) {\n            comp = byIdnumber.get(code);\n          }\n          // Get shortname\n          if (!comp && name && byShortExact.has(name)) {\n            comp = byShortExact.get(name);\n          }\n          // Get name and description\n          if (!comp && name) {\n            comp = list.find(function(c) { return norm(c.description).includes(name); });\n          }\n          // Get name and shortname\n          if (!comp && name) {\n            comp = list.find(function(c) { return norm(c.shortname).includes(name); });\n          }\n\n          return comp ?\n            { input: original, id: comp.id, idnumber: comp.idnumber, shortname: comp.shortname } :\n            { input: original, id: null };\n        });\n\n        var matchedIds = matches\n          .filter(function(m) { return m.id !== null && m.id !== undefined; })\n          .map(function(m) { return m.id; });\n\n        resolve({ matches: matches, matchedIds: matchedIds, list: list });\n      }).fail(function(err) {\n        reject(err);\n      });\n    });\n  };\n\n  // Modal that shows the ai response competencies to the user, here the user will be able to select which should be added to the course\n  var openModal = function(values) {\n    return Str.get_string('applytsks_title', 'aiplacement_classifyassist').then(function(title) {\n      return Templates.render('aiplacement_classifyassist/applytsks_modal', {\n        tasks: values.tasks || [],\n        skills: values.skills || [],\n        knowledge: values.knowledge || [],\n        hastasks: !!(values.tasks && values.tasks.length),\n        hasskills: !!(values.skills && values.skills.length),\n        hasknowledge: !!(values.knowledge && values.knowledge.length)\n      }).then(function(html, js) {\n        var api = getModalAPI();\n        if (!api.create) { throw new Error('No modal API available'); }\n\n        var opts = { title: title, body: html, large: true };\n        if (api.types && api.types.SAVE_CANCEL) { opts.type = api.types.SAVE_CANCEL; }\n\n        return api.create(opts).then(function(modal) {\n          if (js) { Templates.runTemplateJS(js); }\n          attachControls(modal.getRoot());\n\n          return new Promise(function(resolve, reject) {\n            modal.getRoot().on(ModalEvents.save, function() {\n              try {\n                var root = modal.getRoot()[0];\n                var picked = collectChecked(root);\n                modal.getRoot().data('selection', picked);\n                sessionStorage.setItem('aiplacement_applytsks:last', JSON.stringify(picked));\n                console.log('Selection saved:', picked);\n\n                var frameworkId = String($('dd[data-frameworkid]').data('frameworkid') || '0');\n\n                matchPickedToCompetencies(frameworkId, picked).then(function(res) {\n                  var sel = modal.getRoot().data('selection') || {};\n                  sel.matchedCompetencyIds = res.matchedIds;\n                  modal.getRoot().data('selection', sel);\n\n                  // Split into matched vs unmatched.\n                  var all = Array.isArray(res.matches) ? res.matches : [];\n                  var matched = all.filter(function (m) {\n                    return m && m.id !== null && m.id !== undefined;\n                  });\n                  var unmatched = all.filter(function (m) {\n                    return !m || m.id === null || m.id === undefined;\n                  });\n\n                  var unmatchedLabels = unmatched\n                    .map(function(m){ return (m && m.input) ? String(m.input).trim() : ''; })\n                    .filter(Boolean);\n\n\n                  console.log('Competency list:', res.list);\n                  console.log('Matched (with ids):', matched);\n                  console.log('Unmatched (no id):', unmatchedLabels);\n                  console.log('Matched competency IDs:', res.matchedIds);\n\n                  var courseId = getCourseIdFromBody();\n                  var pickedNow = collectChecked(root);\n\n                  if (!courseId) {\n                    Str.get_string('notify_nocourseid', 'aiplacement_classifyassist').then(function(msg) {\n                      Notification.addNotification({ type: 'warning', message: msg });\n                    });\n                    resolve(pickedNow);\n                    modal.hide();\n                    return;\n                  }\n\n                  // Add competencies to course\n                  addCompetenciesToCourse(courseId, res.matchedIds).then(function(outcomes) {\n                    var byId = new Map();\n                    matched.forEach(function(m) { if (m.id) { byId.set(m.id, m); } });\n\n                    var added = [], exists = [], failed = [];\n                    outcomes.forEach(function(o) {\n                      if (o.error) { failed.push(o.id); return; }\n                      if (o.result === false) {\n                        exists.push(o.id);\n                      } else if (o.result === true || o.result === 1 || o.result === '1') {\n                        added.push(o.id);\n                      } else {\n                        (o.result ? added : exists).push(o.id);\n                      }\n                    });\n\n                    var nameOf = function(id) {\n                      var m = byId.get(id);\n                      if (!m) { return 'ID ' + id; }\n                      return m.shortname || m.input || ('ID ' + id);\n                    };\n\n                    var addedNames  = added.map(nameOf);\n                    var existsNames = exists.map(nameOf);\n                    var failedNames = failed.map(nameOf).concat(unmatchedLabels);\n\n                    if (added.length) {\n                      Str.get_string('notify_added_heading', 'aiplacement_classifyassist', { count: added.length })\n                        .then(function(heading) {\n                          Notification.addNotification({\n                            type: 'success',\n                            message: '<div>' + esc(heading) + '</div>' + renderList(addedNames)\n                          });\n                        });\n                    }\n\n                    if (exists.length) {\n                      Str.get_string('notify_exists_heading', 'aiplacement_classifyassist', { count: exists.length })\n                        .then(function(heading) {\n                          Notification.addNotification({\n                            type: 'warning',\n                            message: '<div>' + esc(heading) + '</div>' + renderList(existsNames)\n                          });\n                        });\n                    }\n\n                    if (failedNames.length) {\n                      Str.get_string('notify_failed_heading', 'aiplacement_classifyassist', { count: failedNames.length })\n                        .then(function(heading) {\n                          Notification.addNotification({\n                            type: 'error',\n                            message: '<div>' + esc(heading) + '</div>' + renderList(failedNames)\n                          });\n                        });\n                    }\n\n                    resolve(pickedNow);\n                    modal.hide();\n                  }).catch(function(err) {\n                    console.error('Failed to add competencies to course:', err);\n                    Notification.exception(err);\n                    resolve(pickedNow);\n                    modal.hide();\n                  });\n                }).catch(function(err) {\n                  console.error('Failed to list/match competencies:', err);\n                  reject(err);\n                });\n\n              } catch (err) {\n                console.error(err);\n                reject(err);\n              }\n            });\n            modal.show();\n          });\n        });\n      });\n    });\n  };\n\n  var dispatchApply = function(payload, context) {\n    var ev;\n    try {\n      ev = new CustomEvent('aiplacement_classifyassist:apply', { detail: payload, bubbles: true });\n    } catch (e) {\n      ev = document.createEvent('CustomEvent');\n      ev.initCustomEvent('aiplacement_classifyassist:apply', true, false, payload);\n    }\n    (context || document).dispatchEvent(ev);\n  };\n\n  var handleClick = function(btn) {\n    var card = btn.closest('.card-text.content');\n    if (!card) { return; }\n    var content = card.querySelector('.course-assist-response-content');\n    var values = extractFromResponse(content);\n\n    openModal(values).then(function(edited) {\n      if (!edited) { return; }\n      var contentEl = card.querySelector('[id^=\"course-assist-response-content-\"]');\n      var uniqid = contentEl ? contentEl.id : null;\n\n      dispatchApply(\n        { uniqid: uniqid, action: 'applytsks', values: edited },\n        contentEl || document\n      );\n    });\n  };\n\n  var init = function() {\n    document.addEventListener('click', function(e) {\n      var btn = e.target.closest('button[data-action=\"applytsks\"]');\n      if (!btn) { return; }\n      e.preventDefault();\n      handleClick(btn);\n    }, { passive: false });\n  };\n\n  return { init: init };\n});\n"],"names":["define","Modal","ModalFactory","ModalEvents","Templates","Str","Ajax","$","Notification","toArray","nl","Array","prototype","slice","call","MAP","tasks","skills","knowledge","collectChecked","root","pick","section","sel","querySelectorAll","map","cb","row","closest","span","querySelector","textContent","trim","filter","Boolean","esc","s","String","replace","renderList","items","t","join","norm","toLowerCase","openModal","values","get_string","then","title","render","hastasks","length","hasskills","hasknowledge","html","js","hasNew","api","create","bind","types","TYPE","Error","opts","body","large","SAVE_CANCEL","type","modal","$root","runTemplateJS","getRoot","on","e","preventDefault","sec","currentTarget","forEach","checked","trigger","save","Promise","resolve","reject","picked","data","sessionStorage","setItem","JSON","stringify","console","log","frameworkId","methodname","args","filters","column","value","sort","order","skip","limit","done","response","list","isArray","competencies","byIdnumber","Map","byShortExact","c","idn","idnumber","sn","shortname","set","matches","concat","str","original","parts","split","code","name","comp","has","get","find","description","includes","input","id","matchedIds","m","undefined","fail","err","matchPickedToCompetencies","res","matchedCompetencyIds","all","matched","unmatched","unmatchedLabels","courseId","document","className","match","parseInt","pickedNow","msg","addNotification","message","hide","competencyIds","calls","courseid","competencyid","reqs","p","idx","result","catch","error","addCompetenciesToCourse","outcomes","byId","added","exists","failed","o","push","nameOf","addedNames","existsNames","failedNames","count","heading","exception","show","handleClick","btn","card","out","dl","dt","key","dd","nextElementSibling","tagName","li","innerText","extractFromResponse","edited","contentEl","payload","context","ev","CustomEvent","detail","bubbles","createEvent","initCustomEvent","dispatchEvent","dispatchApply","uniqid","action","init","addEventListener","target","passive"],"mappings":"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"}