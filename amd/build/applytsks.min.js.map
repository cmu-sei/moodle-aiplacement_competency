{"version":3,"file":"applytsks.min.js","sources":["../src/applytsks.js"],"sourcesContent":["define([\n  'core/modal',\n  'core/modal_factory',\n  'core/modal_events',\n  'core/templates',\n  'core/str',\n  'core/ajax',\n  'jquery',\n  'core/notification'\n], function(Modal, ModalFactory, ModalEvents, Templates, Str, Ajax, $, Notification) {\n\n  var toArray = function(nl) { return Array.prototype.slice.call(nl || []); };\n  var MAP = { tasks: 'tasks', skills: 'skills', knowledge: 'knowledge' };\n\n  var getModalAPI = function() {\n    var hasNew = Modal && typeof Modal.create === 'function';\n    return {\n      create: hasNew ? Modal.create.bind(Modal)\n        : (ModalFactory && ModalFactory.create.bind(ModalFactory)),\n      types: (hasNew && (Modal.types || Modal.TYPE)) ||\n        (ModalFactory && ModalFactory.types) ||\n        null\n    };\n  };\n\n  var extractFromResponse = function(root) {\n    var out = { tasks: [], skills: [], knowledge: [] };\n    if (!root) { return out; }\n    var dl = root.querySelector('dl');\n    if (!dl) { return out; }\n\n    toArray(dl.querySelectorAll('dt')).forEach(function(dt) {\n      var key = MAP[(dt.textContent || '').trim().toLowerCase()];\n      if (!key) { return; }\n      var dd = dt.nextElementSibling;\n      if (!dd || dd.tagName.toLowerCase() !== 'dd') { return; }\n\n      out[key] = toArray(dd.querySelectorAll('li'))\n        .map(function(li) { return (li.innerText || '').trim(); })\n        .filter(Boolean)\n        .filter(function(s) { return s.toLowerCase() !== 'none'; });\n    });\n    return out;\n  };\n\n  var collectChecked = function(root) {\n    var pick = function(section) {\n      var sel = '.aiplacement-applytsks-section[data-section=\"' + section + '\"] input[type=\"checkbox\"]:checked';\n      return toArray(root.querySelectorAll(sel)).map(function(cb) {\n        var row = cb.closest('label');\n        var span = row && row.querySelector('span');\n        return span ? span.textContent.trim() : null;\n      }).filter(Boolean);\n    };\n    return { tasks: pick('tasks'), skills: pick('skills'), knowledge: pick('knowledge') };\n  };\n\n  var attachControls = function($root) {\n    $root.on('click', '[data-action=\"selectall\"]', function(e) {\n      e.preventDefault();\n      var sec = e.currentTarget.closest('.aiplacement-applytsks-section');\n      if (sec) {\n        toArray(sec.querySelectorAll('input[type=\"checkbox\"]')).forEach(function(cb) { cb.checked = true; });\n      }\n    });\n    $root.on('click', '[data-action=\"clearall\"]', function(e) {\n      e.preventDefault();\n      var sec = e.currentTarget.closest('.aiplacement-applytsks-section');\n      if (sec) {\n        toArray(sec.querySelectorAll('input[type=\"checkbox\"]')).forEach(function(cb) { cb.checked = false; });\n      }\n    });\n\n    $root.on('click', '[data-action=\"apply-inline\"]', function(e) {\n      e.preventDefault();\n      $root.trigger(ModalEvents.save);\n    });\n  };\n\n// Get course id from activity body\nvar getCourseIdFromBody = function() {\n  var cls = (document.body && document.body.className) || '';\n  var m = cls.match(/(?:^|\\s)course-(\\d+)(?:\\s|$)/);\n  return m ? parseInt(m[1], 10) : null;\n};\n\n// Add user selected competencies from the modal to the course\nvar addCompetenciesToCourse = function(courseId, competencyIds) {\n  if (!courseId || !Array.isArray(competencyIds) || competencyIds.length === 0) {\n    return Promise.resolve();\n  }\n\n  var calls = competencyIds.map(function(id) {\n    return {\n      methodname: 'core_competency_add_competency_to_course',\n      args: { courseid: courseId, competencyid: id }\n    };\n  });\n\n  var promises = require('core/ajax').call(calls);\n  return Promise.all(promises).then(function(results) {\n    console.log('Added competencies to course=' + courseId + ':', competencyIds, results);\n  });\n};\n\n  var norm = function(s) {\n    return (s === null || s === undefined ? '' : String(s)).toLowerCase().trim();\n  };\n\n  // Matches the competencies selected from the modal with the system's competencies\n  var matchPickedToCompetencies = function(frameworkId, picked) {\n    return new Promise(function(resolve, reject) {\n      var calls = Ajax.call([{\n        methodname: 'core_competency_list_competencies',\n        args: {\n          filters: [\n            { column: 'competencyframeworkid', value: String(frameworkId) }\n          ],\n          sort: 'shortname',\n          order: 'ASC',\n          skip: 0,\n          limit: 0\n        }\n      }]);\n\n      calls[0].done(function(response) {\n        var list = Array.isArray(response) ? response : (response.competencies || []);\n        var byIdnumber = new Map();\n        var byShortExact = new Map();\n        list.forEach(function(c) {\n          var idn = norm(c.idnumber);\n          var sn = norm(c.shortname);\n          if (idn) { byIdnumber.set(idn, c); }\n          if (sn) { byShortExact.set(sn, c); }\n        });\n\n        var inputs = []\n          .concat(picked.tasks || [])\n          .concat(picked.skills || [])\n          .concat(picked.knowledge || []);\n\n        var matches = inputs.map(function(str) {\n          var original = str || '';\n          var parts = original.split(' - ');\n          var code = norm(parts[0] || '');\n          var name = norm(parts.slice(1).join(' - '));\n          var comp = null;\n\n          // Get idnumber\n          if (code && byIdnumber.has(code)) {\n            comp = byIdnumber.get(code);\n          }\n          // Get shortname\n          if (!comp && name && byShortExact.has(name)) {\n            comp = byShortExact.get(name);\n          }\n          // Get name and description\n          if (!comp && name) {\n            comp = list.find(function(c) { return norm(c.description).includes(name); });\n          }\n          // Get name and shortname\n          if (!comp && name) {\n            comp = list.find(function(c) { return norm(c.shortname).includes(name); });\n          }\n\n          return comp ?\n            { input: original, id: comp.id, idnumber: comp.idnumber, shortname: comp.shortname } :\n            { input: original, id: null };\n        });\n\n        var matchedIds = matches\n          .filter(function(m) { return m.id !== null && m.id !== undefined; })\n          .map(function(m) { return m.id; });\n\n        resolve({ matches: matches, matchedIds: matchedIds, list: list });\n      }).fail(function(err) {\n        reject(err);\n      });\n    });\n  };\n\n // Modal that shows the ai response competencies to the user, here the user will be able to select which should be added to the course\n  var openModal = function(values) {\n    return Str.get_string('applytsks_title', 'aiplacement_classifyassist').then(function(title) {\n      return Templates.render('aiplacement_classifyassist/applytsks_modal', {\n        tasks: values.tasks || [],\n        skills: values.skills || [],\n        knowledge: values.knowledge || [],\n        hastasks: !!(values.tasks && values.tasks.length),\n        hasskills: !!(values.skills && values.skills.length),\n        hasknowledge: !!(values.knowledge && values.knowledge.length)\n      }).then(function(html, js) {\n        var api = getModalAPI();\n        if (!api.create) { throw new Error('No modal API available'); }\n\n        var opts = { title: title, body: html, large: true };\n        if (api.types && api.types.SAVE_CANCEL) { opts.type = api.types.SAVE_CANCEL; }\n\n        return api.create(opts).then(function(modal) {\n          if (js) { Templates.runTemplateJS(js); }\n          attachControls(modal.getRoot());\n\n          return new Promise(function(resolve, reject) {\n            modal.getRoot().on(ModalEvents.save, function() {\n              try {\n                var root = modal.getRoot()[0];\n                var picked = collectChecked(root);\n                modal.getRoot().data('selection', picked);\n                sessionStorage.setItem('aiplacement_applytsks:last', JSON.stringify(picked));\n                console.log('Selection saved:', picked);\n\n                var frameworkId = String($('dd[data-frameworkid]').data('frameworkid') || '0');\n\n                matchPickedToCompetencies(frameworkId, picked)\n                  .then(function(res) {\n                    // Save for later usage.\n                    var sel = modal.getRoot().data('selection') || {};\n                    sel.matchedCompetencyIds = res.matchedIds;\n                    modal.getRoot().data('selection', sel);\n\n                    // Debug logs.\n                    console.log('Competency list:', res.list);\n                    console.log('Matched competencies:', res.matches);\n                    console.log('Matched competency IDs:', res.matchedIds);\n\n                    var courseId = getCourseIdFromBody();\n                    console.log('Detected course id from body:', courseId);\n\n                    var pickedNow = collectChecked(root); // keep once\n\n                    if (!courseId) {\n                      console.warn('No course-* class found on <body>; cannot add competencies to course.');\n                      Notification.addNotification({\n                        type: 'warning',\n                        message: 'Could not detect course id; nothing was added.'\n                      });\n                      resolve(pickedNow);\n                      modal.hide();\n                      return;\n                    }\n\n                    if (!res.matchedIds.length) {\n                      Notification.addNotification({\n                        type: 'info',\n                        message: 'No matching competencies were found to add.'\n                      });\n                      resolve(pickedNow);\n                      modal.hide();\n                      return;\n                    }\n\n                    // We have matched IDs and a course id â€” add them.\n                    addCompetenciesToCourse(courseId, res.matchedIds)\n                      .then(function() {\n                        // Build a friendly list of what we added for the success message.\n                        var added = res.matches.filter(function(m) {\n                          return m.id && res.matchedIds.indexOf(m.id) !== -1;\n                        });\n\n                        var names = added.map(function(m) {\n                          // Prefer \"[ID] Shortname\" when we have those; otherwise fall back to the original input line.\n                          var parts = [];\n                          if (m.idnumber) { parts.push('[' + m.idnumber + ']'); }\n                          if (m.shortname) { parts.push(m.shortname); }\n                          var nice = parts.length ? parts.join(' ') : (m.input || '');\n                          return nice;\n                        });\n\n                        var message = 'Added ' + added.length + ' competencies to this course: ' + names.join(', ');\n\n                        Notification.addNotification({\n                          type: 'success',\n                          message: message\n                        });\n\n                        resolve(pickedNow);\n                        modal.hide();\n                      })\n                      .catch(function(err) {\n                        console.error('Failed to add competencies to course:', err);\n                        Notification.exception(err);\n                        resolve(pickedNow);\n                        modal.hide();\n                      });\n                  })\n                  .catch(function(err) {\n                    console.error('Failed to list/match competencies:', err);\n                    reject(err);\n                  });\n              } catch (err) {\n                console.error(err);\n                reject(err);\n              }\n            });\n            modal.show();\n          });\n        });\n      });\n    });\n  };\n\n  var dispatchApply = function(payload, context) {\n    var ev;\n    try {\n      ev = new CustomEvent('aiplacement_classifyassist:apply', { detail: payload, bubbles: true });\n    } catch (e) {\n      ev = document.createEvent('CustomEvent');\n      ev.initCustomEvent('aiplacement_classifyassist:apply', true, false, payload);\n    }\n    (context || document).dispatchEvent(ev);\n  };\n\n  var handleClick = function(btn) {\n    var card = btn.closest('.card-text.content');\n    if (!card) { return; }\n    var content = card.querySelector('.course-assist-response-content');\n    var values = extractFromResponse(content);\n\n    openModal(values).then(function(edited) {\n      if (!edited) { return; }\n      var contentEl = card.querySelector('[id^=\"course-assist-response-content-\"]');\n      var uniqid = contentEl ? contentEl.id : null;\n\n      dispatchApply(\n        { uniqid: uniqid, action: 'applytsks', values: edited },\n        contentEl || document\n      );\n    });\n  };\n\n  var init = function() {\n    document.addEventListener('click', function(e) {\n      var btn = e.target.closest('button[data-action=\"applytsks\"]');\n      if (!btn) { return; }\n      e.preventDefault();\n      handleClick(btn);\n    }, { passive: false });\n  };\n\n  return { init: init };\n});\n"],"names":["define","Modal","ModalFactory","ModalEvents","Templates","Str","Ajax","$","Notification","toArray","nl","Array","prototype","slice","call","MAP","tasks","skills","knowledge","collectChecked","root","pick","section","sel","querySelectorAll","map","cb","row","closest","span","querySelector","textContent","trim","filter","Boolean","norm","s","String","toLowerCase","openModal","values","get_string","then","title","render","hastasks","length","hasskills","hasknowledge","html","js","hasNew","api","create","bind","types","TYPE","Error","opts","body","large","SAVE_CANCEL","type","modal","$root","runTemplateJS","getRoot","on","e","preventDefault","sec","currentTarget","forEach","checked","trigger","save","Promise","resolve","reject","picked","data","sessionStorage","setItem","JSON","stringify","console","log","frameworkId","methodname","args","filters","column","value","sort","order","skip","limit","done","response","list","isArray","competencies","byIdnumber","Map","byShortExact","c","idn","idnumber","sn","shortname","set","matches","concat","str","original","parts","split","code","name","join","comp","has","get","find","description","includes","input","id","matchedIds","m","undefined","fail","err","matchPickedToCompetencies","res","matchedCompetencyIds","courseId","document","className","match","parseInt","pickedNow","competencyIds","calls","courseid","competencyid","promises","require","all","results","addCompetenciesToCourse","added","indexOf","names","push","message","addNotification","hide","catch","error","exception","warn","show","handleClick","btn","card","out","dl","dt","key","dd","nextElementSibling","tagName","li","innerText","extractFromResponse","edited","contentEl","payload","context","ev","CustomEvent","detail","bubbles","createEvent","initCustomEvent","dispatchEvent","dispatchApply","uniqid","action","init","addEventListener","target","passive"],"mappings":"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"}