define("aiplacement_classifyassist/placement",["aiplacement_courseassist/placement","core/templates","core/ajax","core/notification","core/str"],(function(Base,Templates,Ajax,Notification,Str){return class extends Base{constructor(userId,contextId){super(userId,contextId),this.aiDrawerElement=document.querySelector("#ai-classify-drawer"),this.aiDrawerBodyElement=this.aiDrawerElement.querySelector(".ai-drawer-body"),this.aiDrawerCloseElement=this.aiDrawerElement.querySelector("#ai-classify-drawer-close"),this.aiDrawerCloseElement&&this.aiDrawerCloseElement.addEventListener("click",(e=>{e.preventDefault(),this.closeAIDrawer()})),this.registerExtraListener()}registerExtraListener(){document.addEventListener("click",(async e=>{if(!e.target.closest('[data-action="classify"]'))return;e.preventDefault(),this.openAIDrawer();let prompt="";const tex=document.querySelector("#id_introeditor");prompt=tex?tex.value.trim():this.getTextContent().trim(),prompt?this.sendClassification(prompt):Notification.error("No content found to classify.")}))}async sendClassification(prompt){if(!prompt)return Notification.error("No prompt provided.");this.aiDrawerBodyElement.dataset.cancelled="0";const loadingHtml=await Templates.render("aiplacement_classifyassist/loading",{});this.aiDrawerBodyElement.innerHTML=loadingHtml;const cancelBtn=this.aiDrawerBodyElement.querySelector('[data-action="cancel"]');cancelBtn&&cancelBtn.addEventListener("click",(e=>{e.preventDefault(),this.setRequestCancelled(),this.toggleAIDrawer(),this.aiDrawerBodyElement.innerHTML=""}));try{const calls=Ajax.call([{methodname:"aiplacement_classifyassist_classify_text",args:{contextid:this.contextId,prompttext:prompt}}]),result=await calls[0];if(this.isRequestCancelled())return void(this.aiDrawerBodyElement.dataset.cancelled="0");const{frameworkid:frameworkid,frameworkshortname:frameworkshortname,tasks:tasks,skills:skills,knowledge:knowledge}=result,uniqid="resp-"+Math.random().toString(36).substr(2,9),heading=await Str.get_string("classifyheading","aiplacement_classifyassist"),responseHtml=await Templates.render("aiplacement_classifyassist/response",{heading:heading,action:heading,uniqid:uniqid,frameworkid:frameworkid,frameworkshortname:frameworkshortname,tasks:tasks,skills:skills,knowledge:knowledge});this.aiDrawerBodyElement.innerHTML=responseHtml;const regen=this.aiDrawerBodyElement.querySelector('[data-action="regenerate"]');regen&&regen.addEventListener("click",(e=>{e.preventDefault(),this.sendClassification(prompt)}))}catch(error){if(!this.isRequestCancelled()){const errorHtml=await Templates.render("aiplacement_classifyassist/error",{});this.aiDrawerBodyElement.innerHTML=errorHtml,Notification.exception(error)}}finally{this.aiDrawerBodyElement.dataset.cancelled="0"}}}}));

//# sourceMappingURL=placement.min.js.map