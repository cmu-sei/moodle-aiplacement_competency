function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function _regenerator(){var p,e="function"==typeof Symbol?Symbol:{},t=e.iterator||"@@iterator",r=e.toStringTag||"@@toStringTag";function n(e,t,r,n){var o,a,i,c,l,s,u,d,f,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype);return _regeneratorDefine2(t,"_invoke",(o=e,a=r,u=n||[],d=!1,f={p:s=0,n:0,v:p,a:y,f:y.bind(p,4),d:function(e,t){return i=e,c=0,l=p,f.n=t,m}},function(e,t,r){if(1<s)throw TypeError("Generator is already running");for(d&&1===t&&y(t,r),c=t,l=r;(h=c<2?p:l)||!d;){i||(c?c<3?(1<c&&(f.n=-1),y(c,l)):f.n=l:f.v=l);try{if(s=2,i){if(h=i[e=c?e:"next"]){if(!(h=h.call(i,l)))throw TypeError("iterator result is not an object");if(!h.done)return h;l=h.value,c<2&&(c=0)}else 1===c&&(h=i.return)&&h.call(i),c<2&&(l=TypeError("The iterator does not provide a '"+e+"' method"),c=1);i=p}else if((h=(d=f.n<0)?l:o.call(a,f))!==m)break}catch(e){i=p,c=1,l=e}finally{s=1}}return{value:h,done:d}}),!0),t;function y(e,t){for(c=e,l=t,h=0;!d&&s&&!r&&h<u.length;h++){var r,n=u[h],o=f.p,a=n[2];3<e?(r=a===t)&&(l=n[(c=n[4])?5:c=3],n[4]=n[5]=p):n[0]<=o&&((r=e<2&&o<n[1])?(c=0,f.v=t,f.n=n[1]):o<a&&(r=e<3||n[0]>t||a<t)&&(n[4]=e,n[5]=t,f.n=a,c=0))}if(r||1<e)return m;throw d=!0,t}}var m={};function v(){}function o(){}function a(){}var h=Object.getPrototypeOf,e=[][t]?h(h([][t]())):(_regeneratorDefine2(h={},t,function(){return this}),h),i=a.prototype=v.prototype=Object.create(e);function c(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,_regeneratorDefine2(e,r,"GeneratorFunction")),e.prototype=Object.create(i),e}return _regeneratorDefine2(i,"constructor",o.prototype=a),_regeneratorDefine2(a,"constructor",o),_regeneratorDefine2(a,r,o.displayName="GeneratorFunction"),_regeneratorDefine2(i),_regeneratorDefine2(i,r,"Generator"),_regeneratorDefine2(i,t,function(){return this}),_regeneratorDefine2(i,"toString",function(){return"[object Generator]"}),(_regenerator=function(){return{w:n,m:c}})()}function _regeneratorDefine2(e,t,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(_regeneratorDefine2=function(e,t,r,n){function o(t,r){_regeneratorDefine2(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(o("next",0),o("throw",1),o("return",2))})(e,t,r,n)}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=c.apply(e,i);function o(e){asyncGeneratorStep(n,t,r,o,a,"next",e)}function a(e){asyncGeneratorStep(n,t,r,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}define(["aiplacement_courseassist/placement","core/templates","core/ajax","core/notification","core/str"],function(e,h,_,w,b){var g='[data-action="cancel"]',p='[data-action="continue"]',m='[data-action="back"]',d="#classify-preselect";return(()=>{function n(e,t){var r;return _classCallCheck(this,n),(r=_callSuper(this,n,[e,t])).aiDrawerElement=document.querySelector("#ai-classify-drawer"),r.aiDrawerBodyElement=r.aiDrawerElement.querySelector(".ai-drawer-body"),r.aiDrawerCloseElement=r.aiDrawerElement.querySelector("#ai-classify-drawer-close"),r.aiDrawerCloseElement&&r.aiDrawerCloseElement.addEventListener("click",function(e){e.preventDefault(),r.closeAIDrawer()}),r._levels=[],r.registerExtraListener(),r}return _inherits(n,e),_createClass(n,[{key:"registerExtraListener",value:function(){var c=this;document.addEventListener("click",(()=>{var t=_asyncToGenerator(_regenerator().m(function e(t){var r,n,o,a,i;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(r=t.target.closest('[data-action="retry"]'))||!c.aiDrawerElement.contains(r)){e.n=6;break}if(t.preventDefault(),r.disabled=!0,e.p=1,n=document.querySelector("#id_introeditor")||document.querySelector('[name="intro[text]"]'),o=document.querySelector('[id^="id_introeditor"][contenteditable="true"]'),n=(n&&"string"==typeof n.value?n.value.trim():"")||(o&&o.textContent?o.textContent.trim():"")){e.n=3;break}return e.n=2,h.render("aiplacement_competency/error",{});case 2:return o=e.v,c.aiDrawerBodyElement.innerHTML=o,e.a(2);case 3:return e.n=4,c.showSelectFramework(n);case 4:return e.p=4,r.disabled=!1,e.f(4);case 5:return e.a(2);case 6:if(t.target.closest('[data-action="classify"]')){e.n=7;break}return e.a(2);case 7:if(t.preventDefault(),c.openAIDrawer(),a=document.querySelector("#id_introeditor")||document.querySelector('[name="intro[text]"]'),i=document.querySelector('[id^="id_introeditor"][contenteditable="true"]'),a=(a&&"string"==typeof a.value?a.value.trim():"")||(i&&i.textContent?i.textContent.trim():"")){e.n=9;break}return b.get_string("notify_empty_description","aiplacement_competency").catch(function(){return"No content found to classify."}).then(function(e){return w.addNotification({type:"error",message:e})}),e.n=8,h.render("aiplacement_competency/error",{});case 8:return i=e.v,c.aiDrawerBodyElement.innerHTML=i,e.a(2);case 9:return e.n=10,c.showSelectFramework(a);case 10:return e.a(2)}},e,null,[[1,,4,5]])}));return function(e){return t.apply(this,arguments)}})())}},{key:"showSelectFramework",value:(t=_asyncToGenerator(_regenerator().m(function e(t){var n,r,o,a,i,c,l,s,u=this;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.aiDrawerBodyElement.dataset.cancelled="0",e.n=1,h.render("aiplacement_competency/framework_select",{});case 1:return r=e.v,this.aiDrawerBodyElement.innerHTML=r,(n=this.aiDrawerBodyElement.querySelector(d))&&(n.innerHTML='<option value="" disabled selected>Loadingâ€¦</option>'),e.p=2,r=_.call([{methodname:"core_competency_list_competency_frameworks",args:{sort:"shortname",order:"ASC",skip:0,context:{contextid:1,instanceid:0}}}]),e.n=3,r[0];case 3:r=e.v,i=Array.isArray(null==r?void 0:r.frameworks)?r.frameworks:Array.isArray(r)?r:[],n&&(n.innerHTML="",i.length?((s=document.createElement("option")).value="",s.disabled=!0,s.selected=!0,s.textContent="Select Competency Framework...",n.appendChild(s),i.forEach(function(e){var t=document.createElement("option"),r=(t.value=String(e.id),document.createElement("div"));r.innerHTML=e.shortname||e.name||e.idnumber||"Framework #".concat(e.id),t.textContent=r.textContent,t.dataset.shortname=e.shortname||"",t.dataset.idnumber=e.idnumber||"",n.appendChild(t)})):n.innerHTML='<option value="" disabled selected>No frameworks found</option>'),e.n=5;break;case 4:e.p=4,s=e.v,n&&(n.innerHTML='<option value="" disabled selected>Failed to load frameworks</option>'),w.exception(s);case 5:o=this.aiDrawerBodyElement.querySelector(p),a=this.aiDrawerBodyElement.querySelector(d),i=this.aiDrawerBodyElement.querySelector(m),c=this.aiDrawerBodyElement.querySelector(g),o&&(o.disabled=!0,l=function(){var e=!(!a||!a.value||null!=(e=a.options[a.selectedIndex])&&e.disabled);o.disabled=!e},a&&a.addEventListener("change",l),l(),o.addEventListener("click",function(e){e.preventDefault(),o.disabled||(e=a&&a.selectedOptions?a.selectedOptions[0]:null,u._selectedFrameworkId=a&&a.value?Number(a.value):null,u._selectedFrameworkShortname=e?e.dataset.shortname||e.textContent.trim():null,e={id:u._selectedFrameworkId,shortname:u._selectedFrameworkShortname},u._selectedFramework=e,u.showLevels(t,e))})),i&&i.addEventListener("click",function(e){e.preventDefault(),u.toggleAIDrawer(),u.aiDrawerBodyElement.innerHTML=""}),c&&c.addEventListener("click",function(e){e.preventDefault(),u.setRequestCancelled(),u.toggleAIDrawer(),u.aiDrawerBodyElement.innerHTML=""});case 6:return e.a(2)}},e,this,[[2,4]])})),function(e){return t.apply(this,arguments)})},{key:"showLevels",value:(r=_asyncToGenerator(_regenerator().m(function e(t,r){var n,o,a,i,c,l,s,u,d,f,y=this;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.aiDrawerBodyElement.dataset.cancelled="0",e.n=1,h.render("aiplacement_competency/levels",{options:[]});case 1:return n=e.v,this.aiDrawerBodyElement.innerHTML=n,n=[],e.p=2,o={filters:[{column:"competencyframeworkid",value:String(r.id)},{column:"parentid",value:"0"}],sort:"shortname",order:"ASC",skip:0,limit:0},o=_.call([{methodname:"core_competency_list_competencies",args:o}]),e.n=3,o[0];case 3:o=e.v,n=(n=Array.isArray(null==o?void 0:o.competencies)?o.competencies:Array.isArray(o)?o:[]).filter(function(e){return 0===Number(e.parentid||0)}),e.n=5;break;case 4:e.p=4,f=e.v,null!=(a=this.aiDrawerBodyElement.querySelector(".ai-prestep"))&&a.insertAdjacentHTML("afterbegin",'<div class="alert alert-danger mb-3">Failed to load levels.</div>'),w.exception(f),n=[];case 5:return a=n.map(function(e){var t,r=((e.shortname||"").trim()||e.competencyname&&(null==(r=(t=e.competencyname).trim)?void 0:r.call(t))||(e.idnumber||"").trim()||e.description&&e.description.replace(/<[^>]+>/g,"").trim()||"#".concat(e.id)).replace(/\b[A-Z]{4,}\b/g,function(e){return e.charAt(0)+e.slice(1).toLowerCase()});return{id:"level-".concat(e.shortname),value:String(e.shortname),label:r}}),e.n=6,h.render("aiplacement_competency/levels",{options:a});case 6:f=e.v,this.aiDrawerBodyElement.innerHTML=f,i=this.aiDrawerBodyElement.querySelector(g),c=this.aiDrawerBodyElement.querySelector(m),l=this.aiDrawerBodyElement.querySelector(p),s=this.aiDrawerBodyElement.querySelectorAll('input[name="classify-levels"]'),Array.isArray(this._selectedLevels)&&this._selectedLevels.length&&(u=new Set(this._selectedLevels.map(String)),s.forEach(function(e){e.checked=u.has(e.value)})),d=function(){var e=Array.from(s).some(function(e){return e.checked});l&&(l.disabled=!e)},s.forEach(function(e){return e.addEventListener("change",d)}),d(),l&&l.addEventListener("click",function(e){e.preventDefault(),l.disabled||(e=Array.from(s).filter(function(e){return e.checked}).map(function(e){return e.value}),y._selectedLevels=e,y.sendClassification(t,r,e))}),c&&c.addEventListener("click",function(e){e.preventDefault(),y.showSelectFramework(t)}),i&&i.addEventListener("click",function(e){e.preventDefault(),y.setRequestCancelled(),y.toggleAIDrawer(),y.aiDrawerBodyElement.innerHTML=""});case 7:return e.a(2)}},e,this,[[2,4]])})),function(e,t){return r.apply(this,arguments)})},{key:"sendClassification",value:(o=_asyncToGenerator(_regenerator().m(function e(t,r,n){var o,a,i,c,l,s,u,d,f,y,p,m,v=this;return _regenerator().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.aiDrawerBodyElement.dataset.cancelled="0",e.n=1,h.render("aiplacement_competency/loading",{});case 1:return s=e.v,this.aiDrawerBodyElement.innerHTML=s,(s=this.aiDrawerBodyElement.querySelector(g))&&s.addEventListener("click",function(e){e.preventDefault(),v.setRequestCancelled(),v.toggleAIDrawer(),v.aiDrawerBodyElement.innerHTML=""}),e.p=2,o=r||this._selectedFramework||{id:this._selectedFrameworkId,shortname:this._selectedFrameworkShortname},s=Array.isArray(n)&&n.length?n:Array.isArray(this._selectedLevels)&&this._selectedLevels.length?this._selectedLevels:[],a=_toConsumableArray(new Set(s.map(function(e){return String(e).trim().replace(/\s+/g," ")}).filter(Boolean).map(function(e){return e.toLowerCase()}))),s=_.call([{methodname:"aiplacement_competency_classify_text",args:{contextid:this.contextId,prompttext:t,selectedframeworkid:(null==o?void 0:o.id)||0,selectedframeworkshortname:(null==o?void 0:o.shortname)||"",levels:a}}]),e.n=3,s[0];case 3:if(i=e.v,this.isRequestCancelled())return this.aiDrawerBodyElement.dataset.cancelled="0",e.a(2);e.n=4;break;case 4:return c=i.frameworkid,l=i.frameworkshortname,s=i.usedlevels,u=void 0===s?[]:s,d=i.competencies,d=void 0===d?[]:d,f="resp-"+Math.random().toString(36).substr(2,9),e.n=5,b.get_string("classifyheading","aiplacement_competency");case 5:return y=e.v,e.n=6,h.render("aiplacement_competency/response",{heading:y,action:y,uniqid:f,frameworkid:c,frameworkshortname:l,usedlevels:u,competencies:d});case 6:y=e.v,this.aiDrawerBodyElement.innerHTML=y,(p=this.aiDrawerBodyElement.querySelector('[data-action="regenerate"]'))&&p.addEventListener("click",function(e){e.preventDefault(),v.sendClassification(t,o,a)}),e.n=9;break;case 7:if(e.p=7,m=e.v,this.isRequestCancelled()){e.n=9;break}return e.n=8,h.render("aiplacement_competency/error",{});case 8:p=e.v,this.aiDrawerBodyElement.innerHTML=p,w.exception(m);case 9:return e.p=9,this.aiDrawerBodyElement.dataset.cancelled="0",e.f(9);case 10:return e.a(2)}},e,this,[[2,7,9,10]])})),function(e,t,r){return o.apply(this,arguments)})}]);var o,r,t})()});
//# sourceMappingURL=placement.min.js.map