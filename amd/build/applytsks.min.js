define("aiplacement_classifyassist/applytsks",["core/modal","core/modal_factory","core/modal_events","core/templates","core/str","core/notification"],(function(Modal,ModalFactory,ModalEvents,Templates,Str,Notification){var toArray=function(nl){return Array.prototype.slice.call(nl||[])},MAP={tasks:"tasks",skills:"skills",knowledge:"knowledge"},openModal=function(values){return Str.get_string("applytsks_title","aiplacement_classifyassist").then((function(title){return Templates.render("aiplacement_classifyassist/applytsks_modal",{tasks:values.tasks||[],skills:values.skills||[],knowledge:values.knowledge||[],hastasks:!(!values.tasks||!values.tasks.length),hasskills:!(!values.skills||!values.skills.length),hasknowledge:!(!values.knowledge||!values.knowledge.length)}).then((function(html,js){var hasNew,api={create:(hasNew=Modal&&"function"==typeof Modal.create)?Modal.create.bind(Modal):ModalFactory&&ModalFactory.create.bind(ModalFactory),types:hasNew&&(Modal.types||Modal.TYPE)||ModalFactory&&ModalFactory.types||null};if(!api.create)throw new Error("No modal API available");var opts={title:title,body:html,large:!0};return api.types&&api.types.SAVE_CANCEL&&(opts.type=api.types.SAVE_CANCEL),api.create(opts).then((function(modal){var $root;return js&&Templates.runTemplateJS(js),($root=modal.getRoot()).on("click",'[data-action="selectall"]',(function(e){e.preventDefault();var sec=e.currentTarget.closest(".aiplacement-applytsks-section");sec&&toArray(sec.querySelectorAll('input[type="checkbox"]')).forEach((function(cb){cb.checked=!0}))})),$root.on("click",'[data-action="clearall"]',(function(e){e.preventDefault();var sec=e.currentTarget.closest(".aiplacement-applytsks-section");sec&&toArray(sec.querySelectorAll('input[type="checkbox"]')).forEach((function(cb){cb.checked=!1}))})),$root.on("click",'[data-action="apply-inline"]',(function(e){e.preventDefault(),$root.trigger(ModalEvents.save)})),new Promise((function(resolve,reject){modal.getRoot().on(ModalEvents.save,(function(){try{var root=modal.getRoot()[0];resolve(function(root){var pick=function(section){var sel='.aiplacement-applytsks-section[data-section="'+section+'"] input[type="checkbox"]:checked';return toArray(root.querySelectorAll(sel)).map((function(cb){var row=cb.closest("label"),span=row&&row.querySelector("span");return span?span.textContent.trim():null})).filter(Boolean)};return{tasks:pick("tasks"),skills:pick("skills"),knowledge:pick("knowledge")}}(root)),modal.hide()}catch(err){Notification.exception(err),reject(err)}})),modal.show()}))}))}))}))},handleClick=function(btn){var card=btn.closest(".card-text.content");if(card){var values=function(root){var out={tasks:[],skills:[],knowledge:[]};if(!root)return out;var dl=root.querySelector("dl");return dl?(toArray(dl.querySelectorAll("dt")).forEach((function(dt){var key=MAP[(dt.textContent||"").trim().toLowerCase()];if(key){var dd=dt.nextElementSibling;dd&&"dd"===dd.tagName.toLowerCase()&&(out[key]=toArray(dd.querySelectorAll("li")).map((function(li){return(li.innerText||"").trim()})).filter(Boolean).filter((function(s){return"none"!==s.toLowerCase()})))}})),out):out}(card.querySelector(".course-assist-response-content"));openModal(values).then((function(edited){if(edited){var contentEl=card.querySelector('[id^="course-assist-response-content-"]');!function(payload,context){var ev;try{ev=new CustomEvent("aiplacement_classifyassist:apply",{detail:payload,bubbles:!0})}catch(e){(ev=document.createEvent("CustomEvent")).initCustomEvent("aiplacement_classifyassist:apply",!0,!1,payload)}(context||document).dispatchEvent(ev)}({uniqid:contentEl?contentEl.id:null,action:"applytsks",values:edited},contentEl||document)}}))}};return{init:function(){document.addEventListener("click",(function(e){var btn=e.target.closest('button[data-action="applytsks"]');btn&&(e.preventDefault(),handleClick(btn))}),{passive:!1})}}}));

//# sourceMappingURL=applytsks.min.js.map