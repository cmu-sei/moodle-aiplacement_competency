{"version":3,"file":"placement.min.js","sources":["../src/placement.js"],"sourcesContent":["define([\n    'aiplacement_courseassist/placement',\n    'core/templates',\n    'core/ajax',\n    'core/notification',\n    'core/str'\n], function(Base, Templates, Ajax, Notification, Str) {\n\n    const SELECTOR_CLASSIFY    = '[data-action=\"classify\"]';\n    const SELECTOR_CANCEL      = '[data-action=\"cancel\"]';\n    const SELECTOR_CONTINUE    = '[data-action=\"continue\"]';\n    const SELECTOR_BACK        = '[data-action=\"back\"]';\n    const SELECTOR_PRESELECT   = '#classify-preselect';\n    const SELECTOR_DOMAINS  = 'input[name=\"classify-domains\"]';\n    const ID_CLOSE_BTN         = '#ai-classify-drawer-close';\n    const SELECTOR_RETRY      = '[data-action=\"retry\"]';\n\n    return class ClassifyPlacement extends Base {\n        constructor(userId, contextId) {\n            super(userId, contextId);\n\n            this.aiDrawerElement      = document.querySelector('#ai-classify-drawer');\n            this.aiDrawerBodyElement  = this.aiDrawerElement.querySelector('.ai-drawer-body');\n            this.aiDrawerCloseElement = this.aiDrawerElement.querySelector(ID_CLOSE_BTN);\n            if (this.aiDrawerCloseElement) {\n                this.aiDrawerCloseElement.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.closeAIDrawer();\n                });\n            }\n\n            this._domains = [];\n            this.registerExtraListener();\n        }\n\n        registerExtraListener() {\n            document.addEventListener('click', async e => {\n                // 1) Retry inside the drawer\n                const retryBtn = e.target.closest(SELECTOR_RETRY);\n                if (retryBtn && this.aiDrawerElement.contains(retryBtn)) {\n                    e.preventDefault();\n                    retryBtn.disabled = true;\n                    try {\n                        // Read activity description\n                        const ta = document.querySelector('#id_introeditor') || document.querySelector('[name=\"intro[text]\"]');\n                        const ce = document.querySelector('[id^=\"id_introeditor\"][contenteditable=\"true\"]');\n                        const prompt =\n                            (ta && typeof ta.value === 'string' ? ta.value.trim() : '') ||\n                            (ce && ce.textContent ? ce.textContent.trim() : '');\n\n                        if (!prompt) {\n                            const errorHtml = await Templates.render('aiplacement_classifyassist/error', {});\n                            this.aiDrawerBodyElement.innerHTML = errorHtml;\n                            return;\n                        }\n                        await this.showSelectFramework(prompt);\n                    } finally {\n                        retryBtn.disabled = false;\n                    }\n                    return;\n                }\n\n                // 2) Classify button\n                const btn = e.target.closest(SELECTOR_CLASSIFY);\n                if (!btn) {\n                    return;\n                }\n\n                e.preventDefault();\n                this.openAIDrawer();\n\n                // If you want to require description here too, use the same strict read:\n                const ta = document.querySelector('#id_introeditor') || document.querySelector('[name=\"intro[text]\"]');\n                const ce = document.querySelector('[id^=\"id_introeditor\"][contenteditable=\"true\"]');\n                const prompt =\n                    (ta && typeof ta.value === 'string' ? ta.value.trim() : '') ||\n                    (ce && ce.textContent ? ce.textContent.trim() : '');\n\n                if (!prompt) {\n                    Str.get_string('notify_empty_description', 'aiplacement_classifyassist')\n                        .catch(() => 'No content found to classify.')\n                        .then(msg => Notification.addNotification({ type: 'error', message: msg }));\n\n                    const errorHtml = await Templates.render('aiplacement_classifyassist/error', {});\n                    this.aiDrawerBodyElement.innerHTML = errorHtml;\n                    return;\n                }\n\n                await this.showSelectFramework(prompt);\n            });\n        }\n\n        // === STEP 1: Select framework ===\n        async showSelectFramework(prompt) {\n            this.aiDrawerBodyElement.dataset.cancelled = '0';\n\n            const prestepHtml = await Templates.render('aiplacement_classifyassist/framework_select', {});\n            this.aiDrawerBodyElement.innerHTML = prestepHtml;\n\n            const select = this.aiDrawerBodyElement.querySelector(SELECTOR_PRESELECT);\n            if (select) {\n                select.innerHTML = '<option value=\"\" disabled selected>Loadingâ€¦</option>';\n            }\n\n            try {\n                const calls = Ajax.call([{\n                    methodname: 'core_competency_list_competency_frameworks',\n                    args: {\n                        sort: 'shortname',\n                        order: 'ASC',\n                        skip: 0,\n                        context: { contextid: 1, instanceid: 0 },\n                    }\n                }]);\n\n                const res = await calls[0];\n                const frameworks = Array.isArray(res?.frameworks) ? res.frameworks\n                                : Array.isArray(res) ? res\n                                : [];\n\n                if (select) {\n                    select.innerHTML = '';\n\n                    if (!frameworks.length) {\n                        select.innerHTML = '<option value=\"\" disabled selected>No frameworks found</option>';\n                    } else {\n                        const ph = document.createElement('option');\n                        ph.value = '';\n                        ph.disabled = true;\n                        ph.selected = true;\n                        ph.textContent = 'Select Competency Framework...';\n                        select.appendChild(ph);\n\n                        frameworks.forEach(fw => {\n                            const opt = document.createElement('option');\n                            opt.value = String(fw.id);\n                            opt.textContent = fw.shortname || fw.name || fw.idnumber || `Framework #${fw.id}`;\n                            opt.dataset.shortname = fw.shortname || '';\n                            opt.dataset.idnumber = fw.idnumber || '';\n                            select.appendChild(opt);\n                        });\n                    }\n                }\n            } catch (error) {\n                if (select) {\n                    select.innerHTML = '<option value=\"\" disabled selected>Failed to load frameworks</option>';\n                }\n                Notification.exception(error);\n            }\n\n            const continueBtn = this.aiDrawerBodyElement.querySelector(SELECTOR_CONTINUE);\n            const sel        = this.aiDrawerBodyElement.querySelector(SELECTOR_PRESELECT);\n            const backBtn    = this.aiDrawerBodyElement.querySelector(SELECTOR_BACK);\n            const cancelBtn  = this.aiDrawerBodyElement.querySelector(SELECTOR_CANCEL);\n\n            if (continueBtn) {\n                continueBtn.disabled = true;\n\n                const updateContinueState = () => {\n                    const hasValue = !!(sel && sel.value && !sel.options[sel.selectedIndex]?.disabled);\n                    continueBtn.disabled = !hasValue;\n                };\n                if (sel) {\n                    sel.addEventListener('change', updateContinueState);\n                }\n\n                updateContinueState();\n\n                continueBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    if (continueBtn.disabled) {\n                        return;\n                    }\n\n                    const opt = sel && sel.selectedOptions ? sel.selectedOptions[0] : null;\n\n                    this._selectedFrameworkId        = sel && sel.value ? Number(sel.value) : null;\n                    this._selectedFrameworkShortname = opt\n                        ? (opt.dataset.shortname || opt.textContent.trim())\n                        : null;\n\n                    const selectedFramework = {\n                        id: this._selectedFrameworkId,\n                        shortname: this._selectedFrameworkShortname,\n                    };\n                    this._selectedFramework = selectedFramework;\n\n                    this.showDomains(prompt, selectedFramework);\n                });\n\n            }\n\n            if (backBtn) {\n                backBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.toggleAIDrawer();\n                    this.aiDrawerBodyElement.innerHTML = '';\n                });\n            }\n\n            if (cancelBtn) {\n                cancelBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.setRequestCancelled();\n                    this.toggleAIDrawer();\n                    this.aiDrawerBodyElement.innerHTML = '';\n                });\n            }\n        }\n\n        // === STEP 2: Select domains (checkboxes) ===\n        async showDomains(prompt, framework) {\n            this.aiDrawerBodyElement.dataset.cancelled = '0';\n\n            const html = await Templates.render('aiplacement_classifyassist/domains', { options: [] });\n            this.aiDrawerBodyElement.innerHTML = html;\n\n            let competencies = [];\n\n            try {\n            const args = {\n                filters: [\n                { column: 'competencyframeworkid', value: String(framework.id) },\n                { column: 'parentid',              value: '0' }\n                ],\n                sort: 'shortname',\n                order: 'ASC',\n                skip: 0,\n                limit: 0\n            };\n\n            const requests = Ajax.call([{\n                methodname: 'core_competency_list_competencies',\n                args\n            }]);\n\n            const res = await requests[0];\n\n            competencies = Array.isArray(res?.competencies) ? res.competencies\n                        : Array.isArray(res) ? res\n                        : [];\n\n            competencies = competencies.filter(c => Number(c.parentid || 0) === 0);\n\n            } catch (error) {\n            this.aiDrawerBodyElement.querySelector('.ai-prestep')?.insertAdjacentHTML(\n                'afterbegin',\n                '<div class=\"alert alert-danger mb-3\">Failed to load domains.</div>'\n            );\n            Notification.exception(error);\n            competencies = [];\n            }\n\n            const options = competencies.map(c => {\n            const raw =\n                (c.shortname || '').trim() ||\n                (c.competencyname && c.competencyname.trim?.()) ||\n                (c.idnumber || '').trim() ||\n                (c.description && c.description.replace(/<[^>]+>/g, '').trim()) ||\n                `#${c.id}`;\n\n            const label = raw\n                .replace(/\\b[A-Z]{4,}\\b/g, w => w.charAt(0) + w.slice(1).toLowerCase());\n\n            return {\n                id: `domain-${c.shortname}`,\n                value: String(c.shortname),\n                label,\n            };\n            });\n\n            const finalHtml = await Templates.render('aiplacement_classifyassist/domains', { options });\n            this.aiDrawerBodyElement.innerHTML = finalHtml;\n\n            const cancelBtn   = this.aiDrawerBodyElement.querySelector(SELECTOR_CANCEL);\n            const backBtn     = this.aiDrawerBodyElement.querySelector(SELECTOR_BACK);\n            const continueBtn = this.aiDrawerBodyElement.querySelector(SELECTOR_CONTINUE);\n            const boxes       = this.aiDrawerBodyElement.querySelectorAll(SELECTOR_DOMAINS);\n\n            if (Array.isArray(this._selectedDomains) && this._selectedDomains.length) {\n                const set = new Set(this._selectedDomains.map(String));\n                boxes.forEach(b => { b.checked = set.has(b.value); });\n            }\n\n            const updateContinue = () => {\n                const anyChecked = Array.from(boxes).some(b => b.checked);\n                if (continueBtn) {\n                    continueBtn.disabled = !anyChecked;\n                }\n            };\n            boxes.forEach(b => b.addEventListener('change', updateContinue));\n            updateContinue();\n\n            if (continueBtn) {\n                continueBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    if (continueBtn.disabled) {\n                        return;\n                    }\n\n                    const selectedDomains = Array.from(boxes)\n                        .filter(b => b.checked)\n                        .map(b => b.value);\n\n                    this._selectedDomains = selectedDomains;\n\n                    this.sendClassification(prompt, framework, selectedDomains);\n                });\n            }\n\n            if (backBtn) {\n                backBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.showSelectFramework(prompt);\n                });\n            }\n\n            if (cancelBtn) {\n                cancelBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.setRequestCancelled();\n                    this.toggleAIDrawer();\n                    this.aiDrawerBodyElement.innerHTML = '';\n                });\n            }\n        }\n\n        // === Final: send classification ===\n        async sendClassification(prompt, framework, domains) {\n            this.aiDrawerBodyElement.dataset.cancelled = '0';\n\n            const loadingHtml = await Templates.render('aiplacement_classifyassist/loading', {});\n            this.aiDrawerBodyElement.innerHTML = loadingHtml;\n\n            const cancelBtn = this.aiDrawerBodyElement.querySelector(SELECTOR_CANCEL);\n            if (cancelBtn) {\n                cancelBtn.addEventListener('click', e => {\n                    e.preventDefault();\n                    this.setRequestCancelled();\n                    this.toggleAIDrawer();\n                    this.aiDrawerBodyElement.innerHTML = '';\n                });\n            }\n\n            try {\n                const fw = framework || this._selectedFramework || {\n                    id: this._selectedFrameworkId,\n                    shortname: this._selectedFrameworkShortname,\n                };\n\n                const rawSelectedDomains =\n                (Array.isArray(domains) && domains.length) ? domains :\n                (Array.isArray(this._selectedDomains) && this._selectedDomains.length) ? this._selectedDomains :\n                [];\n\n                const selectedDomains = [...new Set(\n                rawSelectedDomains\n                    .map(s => String(s).trim().replace(/\\s+/g, ' '))\n                    .filter(Boolean)\n                    .map(s => s.toLowerCase())\n                )];\n\n                const calls = Ajax.call([{\n                    methodname: 'aiplacement_classifyassist_classify_text',\n                    args: {\n                        contextid: this.contextId,\n                        prompttext: prompt,\n                        selectedframeworkid: fw?.id || 0,\n                        selectedframeworkshortname: fw?.shortname || '',\n                        domains: selectedDomains,\n                    }\n                }]);\n\n                const result = await calls[0];\n                if (this.isRequestCancelled()) {\n                    this.aiDrawerBodyElement.dataset.cancelled = '0';\n                    return;\n                }\n\n                const {frameworkid, frameworkshortname, useddomains = [], competencies = []} = result;\n                const uniqid  = 'resp-' + Math.random().toString(36).substr(2, 9);\n                const heading = await Str.get_string('classifyheading', 'aiplacement_classifyassist');\n\n                const responseHtml = await Templates.render(\n                    'aiplacement_classifyassist/response',\n                    {\n                        heading,\n                        action: heading,\n                        uniqid,\n                        frameworkid,\n                        frameworkshortname,\n                        useddomains,\n                        competencies,\n                    }\n                );\n\n                this.aiDrawerBodyElement.innerHTML = responseHtml;\n\n                const regen = this.aiDrawerBodyElement.querySelector('[data-action=\"regenerate\"]');\n                if (regen) {\n                    regen.addEventListener('click', e => {\n                        e.preventDefault();\n                        this.sendClassification(prompt, fw, selectedDomains);\n                    });\n                }\n            } catch (error) {\n                if (!this.isRequestCancelled()) {\n                    const errorHtml = await Templates.render('aiplacement_classifyassist/error', {});\n                    this.aiDrawerBodyElement.innerHTML = errorHtml;\n                    Notification.exception(error);\n                }\n            } finally {\n                this.aiDrawerBodyElement.dataset.cancelled = '0';\n            }\n        }\n    };\n});\n"],"names":["define","Base","Templates","Ajax","Notification","Str","constructor","userId","contextId","aiDrawerElement","document","querySelector","aiDrawerBodyElement","this","aiDrawerCloseElement","addEventListener","e","preventDefault","closeAIDrawer","_domains","registerExtraListener","async","retryBtn","target","closest","contains","disabled","ta","ce","prompt","value","trim","textContent","errorHtml","render","innerHTML","showSelectFramework","openAIDrawer","get_string","catch","then","msg","addNotification","type","message","dataset","cancelled","prestepHtml","select","calls","call","methodname","args","sort","order","skip","context","contextid","instanceid","res","frameworks","Array","isArray","length","ph","createElement","selected","appendChild","forEach","fw","opt","String","id","shortname","name","idnumber","error","exception","continueBtn","sel","backBtn","cancelBtn","updateContinueState","hasValue","options","selectedIndex","_sel$options$sel$sele","selectedOptions","_selectedFrameworkId","Number","_selectedFrameworkShortname","selectedFramework","_selectedFramework","showDomains","toggleAIDrawer","setRequestCancelled","framework","html","competencies","filters","column","limit","requests","filter","c","parentid","insertAdjacentHTML","map","label","competencyname","_c$competencyname$tri","description","replace","w","charAt","slice","toLowerCase","finalHtml","boxes","querySelectorAll","_selectedDomains","set","Set","b","checked","has","updateContinue","anyChecked","from","some","selectedDomains","sendClassification","domains","loadingHtml","rawSelectedDomains","s","Boolean","prompttext","selectedframeworkid","selectedframeworkshortname","result","isRequestCancelled","frameworkid","frameworkshortname","useddomains","uniqid","Math","random","toString","substr","heading","responseHtml","action","regen"],"mappings":"AAAAA,8CAAO,CACH,qCACA,iBACA,YACA,oBACA,aACD,SAASC,KAAMC,UAAWC,KAAMC,aAAcC,YAWtC,cAAgCJ,KACnCK,YAAYC,OAAQC,iBACVD,OAAQC,gBAETC,gBAAuBC,SAASC,cAAc,4BAC9CC,oBAAuBC,KAAKJ,gBAAgBE,cAAc,wBAC1DG,qBAAuBD,KAAKJ,gBAAgBE,cAT5B,6BAUjBE,KAAKC,2BACAA,qBAAqBC,iBAAiB,SAASC,IAChDA,EAAEC,sBACGC,wBAIRC,SAAW,QACXC,wBAGTA,wBACIV,SAASK,iBAAiB,SAASM,MAAAA,UAEzBC,SAAWN,EAAEO,OAAOC,QAvBV,4BAwBZF,UAAYT,KAAKJ,gBAAgBgB,SAASH,UAAW,CACrDN,EAAEC,iBACFK,SAASI,UAAW,YAGVC,GAAKjB,SAASC,cAAc,oBAAsBD,SAASC,cAAc,wBACzEiB,GAAKlB,SAASC,cAAc,kDAC5BkB,QACDF,IAA0B,iBAAbA,GAAGG,MAAqBH,GAAGG,MAAMC,OAAS,MACvDH,IAAMA,GAAGI,YAAcJ,GAAGI,YAAYD,OAAS,QAE/CF,OAAQ,OACHI,gBAAkB/B,UAAUgC,OAAO,mCAAoC,qBACxEtB,oBAAoBuB,UAAYF,iBAGnCpB,KAAKuB,oBAAoBP,gBAE/BP,SAASI,UAAW,aAMhBV,EAAEO,OAAOC,QAvDJ,mCA4DjBR,EAAEC,sBACGoB,qBAGCV,GAAKjB,SAASC,cAAc,oBAAsBD,SAASC,cAAc,wBACzEiB,GAAKlB,SAASC,cAAc,kDAC5BkB,QACDF,IAA0B,iBAAbA,GAAGG,MAAqBH,GAAGG,MAAMC,OAAS,MACvDH,IAAMA,GAAGI,YAAcJ,GAAGI,YAAYD,OAAS,OAE/CF,aAUChB,KAAKuB,oBAAoBP,aAT3BxB,IAAIiC,WAAW,2BAA4B,8BACtCC,OAAM,IAAM,kCACZC,MAAKC,KAAOrC,aAAasC,gBAAgB,CAAEC,KAAM,QAASC,QAASH,cAElER,gBAAkB/B,UAAUgC,OAAO,mCAAoC,SACxEtB,oBAAoBuB,UAAYF,wCASvBJ,aACjBjB,oBAAoBiC,QAAQC,UAAY,UAEvCC,kBAAoB7C,UAAUgC,OAAO,8CAA+C,SACrFtB,oBAAoBuB,UAAYY,kBAE/BC,OAASnC,KAAKD,oBAAoBD,cAvFnB,uBAwFjBqC,SACAA,OAAOb,UAAY,kEAIbc,MAAQ9C,KAAK+C,KAAK,CAAC,CACrBC,WAAY,6CACZC,KAAM,CACFC,KAAM,YACNC,MAAO,MACPC,KAAM,EACNC,QAAS,CAAEC,UAAW,EAAGC,WAAY,OAIvCC,UAAYV,MAAM,GAClBW,WAAaC,MAAMC,QAAQH,MAAAA,WAAAA,IAAKC,YAAcD,IAAIC,WACtCC,MAAMC,QAAQH,KAAOA,IACrB,MAEdX,UACAA,OAAOb,UAAY,GAEdyB,WAAWG,OAET,OACGC,GAAKtD,SAASuD,cAAc,UAClCD,GAAGlC,MAAQ,GACXkC,GAAGtC,UAAW,EACdsC,GAAGE,UAAW,EACdF,GAAGhC,YAAc,iCACjBgB,OAAOmB,YAAYH,IAEnBJ,WAAWQ,SAAQC,WACTC,IAAM5D,SAASuD,cAAc,UACnCK,IAAIxC,MAAQyC,OAAOF,GAAGG,IACtBF,IAAItC,YAAcqC,GAAGI,WAAaJ,GAAGK,MAAQL,GAAGM,+BAA0BN,GAAGG,IAC7EF,IAAIzB,QAAQ4B,UAAYJ,GAAGI,WAAa,GACxCH,IAAIzB,QAAQ8B,SAAWN,GAAGM,UAAY,GACtC3B,OAAOmB,YAAYG,aAfvBtB,OAAOb,UAAY,kEAmB7B,MAAOyC,OACD5B,SACAA,OAAOb,UAAY,yEAEvB/B,aAAayE,UAAUD,aAGrBE,YAAcjE,KAAKD,oBAAoBD,cA5IxB,4BA6IfoE,IAAalE,KAAKD,oBAAoBD,cA3IvB,uBA4IfqE,QAAanE,KAAKD,oBAAoBD,cA7IvB,wBA8IfsE,UAAapE,KAAKD,oBAAoBD,cAhJvB,6BAkJjBmE,YAAa,CACbA,YAAYpD,UAAW,QAEjBwD,oBAAsB,qCAClBC,YAAcJ,MAAOA,IAAIjD,qCAAUiD,IAAIK,QAAQL,IAAIM,iDAAhBC,sBAAgC5D,UACzEoD,YAAYpD,UAAYyD,UAExBJ,KACAA,IAAIhE,iBAAiB,SAAUmE,qBAGnCA,sBAEAJ,YAAY/D,iBAAiB,SAASC,OAClCA,EAAEC,iBACE6D,YAAYpD,sBAIV4C,IAAMS,KAAOA,IAAIQ,gBAAkBR,IAAIQ,gBAAgB,GAAK,UAE7DC,qBAA8BT,KAAOA,IAAIjD,MAAQ2D,OAAOV,IAAIjD,OAAS,UACrE4D,4BAA8BpB,IAC5BA,IAAIzB,QAAQ4B,WAAaH,IAAItC,YAAYD,OAC1C,WAEA4D,kBAAoB,CACtBnB,GAAI3D,KAAK2E,qBACTf,UAAW5D,KAAK6E,kCAEfE,mBAAqBD,uBAErBE,YAAYhE,OAAQ8D,sBAK7BX,SACAA,QAAQjE,iBAAiB,SAASC,IAC9BA,EAAEC,sBACG6E,sBACAlF,oBAAoBuB,UAAY,MAIzC8C,WACAA,UAAUlE,iBAAiB,SAASC,IAChCA,EAAEC,sBACG8E,2BACAD,sBACAlF,oBAAoBuB,UAAY,wBAM/BN,OAAQmE,gBACjBpF,oBAAoBiC,QAAQC,UAAY,UAEvCmD,WAAa/F,UAAUgC,OAAO,qCAAsC,CAAEkD,QAAS,UAChFxE,oBAAoBuB,UAAY8D,SAEjCC,aAAe,aAGb9C,KAAO,CACT+C,QAAS,CACT,CAAEC,OAAQ,wBAAyBtE,MAAOyC,OAAOyB,UAAUxB,KAC3D,CAAE4B,OAAQ,WAAyBtE,MAAO,MAE1CuB,KAAM,YACNC,MAAO,MACPC,KAAM,EACN8C,MAAO,GAGLC,SAAWnG,KAAK+C,KAAK,CAAC,CACxBC,WAAY,oCACZC,KAAAA,QAGEO,UAAY2C,SAAS,GAE3BJ,aAAerC,MAAMC,QAAQH,MAAAA,WAAAA,IAAKuC,cAAgBvC,IAAIuC,aACxCrC,MAAMC,QAAQH,KAAOA,IACrB,GAEduC,aAAeA,aAAaK,QAAOC,GAAiC,IAA5Bf,OAAOe,EAAEC,UAAY,KAE3D,MAAO7B,oEACJhE,oBAAoBD,cAAc,uEAAgB+F,mBACnD,aACA,sEAEJtG,aAAayE,UAAUD,OACvBsB,aAAe,SAGTd,QAAUc,aAAaS,KAAIH,sDAQ3BI,QANDJ,EAAE/B,WAAa,IAAI1C,QACnByE,EAAEK,kEAAkBL,EAAEK,gBAAe9E,6CAAjB+E,iDACpBN,EAAE7B,UAAY,IAAI5C,QAClByE,EAAEO,aAAeP,EAAEO,YAAYC,QAAQ,WAAY,IAAIjF,mBACpDyE,EAAEhC,KAGLwC,QAAQ,kBAAkBC,GAAKA,EAAEC,OAAO,GAAKD,EAAEE,MAAM,GAAGC,sBAEtD,CACH5C,oBAAcgC,EAAE/B,WAChB3C,MAAOyC,OAAOiC,EAAE/B,WAChBmC,MAAAA,UAIES,gBAAkBnH,UAAUgC,OAAO,qCAAsC,CAAEkD,QAAAA,eAC5ExE,oBAAoBuB,UAAYkF,gBAE/BpC,UAAcpE,KAAKD,oBAAoBD,cAzQxB,0BA0QfqE,QAAcnE,KAAKD,oBAAoBD,cAxQxB,wBAyQfmE,YAAcjE,KAAKD,oBAAoBD,cA1QxB,4BA2Qf2G,MAAczG,KAAKD,oBAAoB2G,iBAxQ3B,qCA0Qd1D,MAAMC,QAAQjD,KAAK2G,mBAAqB3G,KAAK2G,iBAAiBzD,OAAQ,OAChE0D,IAAM,IAAIC,IAAI7G,KAAK2G,iBAAiBb,IAAIpC,SAC9C+C,MAAMlD,SAAQuD,IAAOA,EAAEC,QAAUH,IAAII,IAAIF,EAAE7F,gBAGzCgG,eAAiB,WACbC,WAAalE,MAAMmE,KAAKV,OAAOW,MAAKN,GAAKA,EAAEC,UAC7C9C,cACAA,YAAYpD,UAAYqG,aAGhCT,MAAMlD,SAAQuD,GAAKA,EAAE5G,iBAAiB,SAAU+G,kBAChDA,iBAEIhD,aACAA,YAAY/D,iBAAiB,SAASC,OAClCA,EAAEC,iBACE6D,YAAYpD,sBAIVwG,gBAAkBrE,MAAMmE,KAAKV,OAC9Bf,QAAOoB,GAAKA,EAAEC,UACdjB,KAAIgB,GAAKA,EAAE7F,aAEX0F,iBAAmBU,qBAEnBC,mBAAmBtG,OAAQmE,UAAWkC,oBAI/ClD,SACAA,QAAQjE,iBAAiB,SAASC,IAC9BA,EAAEC,sBACGmB,oBAAoBP,WAI7BoD,WACAA,UAAUlE,iBAAiB,SAASC,IAChCA,EAAEC,sBACG8E,2BACAD,sBACAlF,oBAAoBuB,UAAY,+BAMxBN,OAAQmE,UAAWoC,cACnCxH,oBAAoBiC,QAAQC,UAAY,UAEvCuF,kBAAoBnI,UAAUgC,OAAO,qCAAsC,SAC5EtB,oBAAoBuB,UAAYkG,kBAE/BpD,UAAYpE,KAAKD,oBAAoBD,cArUtB,0BAsUjBsE,WACAA,UAAUlE,iBAAiB,SAASC,IAChCA,EAAEC,sBACG8E,2BACAD,sBACAlF,oBAAoBuB,UAAY,gBAKnCkC,GAAK2B,WAAanF,KAAK+E,oBAAsB,CAC/CpB,GAAI3D,KAAK2E,qBACTf,UAAW5D,KAAK6E,6BAGd4C,mBACLzE,MAAMC,QAAQsE,UAAYA,QAAQrE,OAAUqE,QAC5CvE,MAAMC,QAAQjD,KAAK2G,mBAAqB3G,KAAK2G,iBAAiBzD,OAAUlD,KAAK2G,iBAC9E,GAEMU,gBAAkB,IAAI,IAAIR,IAChCY,mBACK3B,KAAI4B,GAAKhE,OAAOgE,GAAGxG,OAAOiF,QAAQ,OAAQ,OAC1CT,OAAOiC,SACP7B,KAAI4B,GAAKA,EAAEnB,kBAGVnE,MAAQ9C,KAAK+C,KAAK,CAAC,CACrBC,WAAY,2CACZC,KAAM,CACFK,UAAW5C,KAAKL,UAChBiI,WAAY5G,OACZ6G,qBAAqBrE,MAAAA,UAAAA,GAAIG,KAAM,EAC/BmE,4BAA4BtE,MAAAA,UAAAA,GAAII,YAAa,GAC7C2D,QAASF,oBAIXU,aAAe3F,MAAM,MACvBpC,KAAKgI,sCACAjI,oBAAoBiC,QAAQC,UAAY,WAI3CgG,YAACA,YAADC,mBAAcA,mBAAdC,YAAkCA,YAAc,GAAhD9C,aAAoDA,aAAe,IAAM0C,OACzEK,OAAU,QAAUC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GACzDC,cAAgBjJ,IAAIiC,WAAW,kBAAmB,8BAElDiH,mBAAqBrJ,UAAUgC,OACjC,sCACA,CACIoH,QAAAA,QACAE,OAAQF,QACRL,OAAAA,OACAH,YAAAA,YACAC,mBAAAA,mBACAC,YAAAA,YACA9C,aAAAA,oBAIHtF,oBAAoBuB,UAAYoH,mBAE/BE,MAAQ5I,KAAKD,oBAAoBD,cAAc,8BACjD8I,OACAA,MAAM1I,iBAAiB,SAASC,IAC5BA,EAAEC,sBACGkH,mBAAmBtG,OAAQwC,GAAI6D,oBAG9C,MAAOtD,WACA/D,KAAKgI,qBAAsB,OACtB5G,gBAAkB/B,UAAUgC,OAAO,mCAAoC,SACxEtB,oBAAoBuB,UAAYF,UACrC7B,aAAayE,UAAUD,qBAGtBhE,oBAAoBiC,QAAQC,UAAY"}