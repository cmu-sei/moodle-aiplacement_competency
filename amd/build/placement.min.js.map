{"version":3,"file":"placement.min.js","sources":["../src/placement.js"],"sourcesContent":["define([\n    'aiplacement_courseassist/placement', // Parent class\n    'core/templates',\n    'core/ajax',\n    'core/notification',\n    'core/str',\n    'core/copy_to_clipboard'\n], function(Base, Templates, Ajax, Notification, Str) {\n\n    const SELECTOR_CLASSIFY = '[data-action=\"classify\"]';\n\n    return class ClassifyPlacement extends Base {\n        constructor(userId, contextId) {\n            super(userId, contextId);\n            this.aiDrawerElement     = document.querySelector('#ai-classify-drawer');\n            this.aiDrawerBodyElement = this.aiDrawerElement.querySelector('.ai-drawer-body');\n            this.registerExtraListener();\n        }\n\n        registerExtraListener() {\n            document.addEventListener('click', async e => {\n                const btn = e.target.closest(SELECTOR_CLASSIFY);\n                if (!btn) {\n                    return;\n                }\n                e.preventDefault();\n                this.openAIDrawer();\n\n                let prompt = '';\n                const tex = document.querySelector('#id_introeditor');\n                if (tex) {\n                    prompt = tex.value.trim();\n                } else {\n                    prompt = this.getTextContent().trim();\n                }\n\n                if (!prompt) {\n                    Notification.error('No content found to classify.');\n                    return;\n                }\n\n                this.sendClassification(prompt);\n            });\n        }\n\n        async sendClassification(prompt) {\n            if (!prompt) {\n                return Notification.error('No prompt provided.');\n            }\n\n            const loadingHtml = await Templates.render(\n                'aiplacement_classifyassist/loading', {}\n            );\n            this.aiDrawerBodyElement.innerHTML = loadingHtml;\n\n            try {\n                const calls = Ajax.call([{\n                    methodname: 'aiplacement_classifyassist_classify_text',\n                    args: {\n                        contextid: this.contextId,\n                        prompttext: prompt\n                    }\n                }]);\n\n                const result = await calls[0];\n                const { role, work_role } = result;\n\n                const uniqid = 'resp-' + Math.random().toString(36).substr(2, 9);\n                const heading = await Str.get_string('classifyheading', 'aiplacement_classifyassist');\n                const responseHtml = await Templates.render(\n                    'aiplacement_classifyassist/response',\n                    {\n                        heading,\n                        action: heading,\n                        uniqid,\n                        role,\n                        work_role\n                    }\n                );\n                this.aiDrawerBodyElement.innerHTML = responseHtml;\n\n                const regen = this.aiDrawerBodyElement.querySelector('[data-action=\"regenerate\"]');\n                if (regen) {\n                    regen.addEventListener('click', e => {\n                        e.preventDefault();\n                        this.sendClassification(prompt);\n                    });\n                }\n            } catch (error) {\n                const errorHtml = await Templates.render(\n                    'aiplacement_classifyassist/error', {}\n                );\n                this.aiDrawerBodyElement.innerHTML = errorHtml;\n                Notification.exception(error);\n            }\n        }\n    };\n});\n"],"names":["define","Base","Templates","Ajax","Notification","Str","constructor","userId","contextId","aiDrawerElement","document","querySelector","aiDrawerBodyElement","this","registerExtraListener","addEventListener","async","e","target","closest","preventDefault","openAIDrawer","prompt","tex","value","trim","getTextContent","sendClassification","error","loadingHtml","render","innerHTML","calls","call","methodname","args","contextid","prompttext","result","role","work_role","uniqid","Math","random","toString","substr","heading","get_string","responseHtml","action","regen","errorHtml","exception"],"mappings":"AAAAA,8CAAO,CACH,qCACA,iBACA,YACA,oBACA,WACA,2BACD,SAASC,KAAMC,UAAWC,KAAMC,aAAcC,YAItC,cAAgCJ,KACnCK,YAAYC,OAAQC,iBACVD,OAAQC,gBACTC,gBAAsBC,SAASC,cAAc,4BAC7CC,oBAAsBC,KAAKJ,gBAAgBE,cAAc,wBACzDG,wBAGTA,wBACIJ,SAASK,iBAAiB,SAASC,MAAAA,QACnBC,EAAEC,OAAOC,QAZP,mCAgBdF,EAAEG,sBACGC,mBAEDC,OAAS,SACPC,IAAMb,SAASC,cAAc,mBAE/BW,OADAC,IACSA,IAAIC,MAAMC,OAEVZ,KAAKa,iBAAiBD,OAG9BH,YAKAK,mBAAmBL,QAJpBlB,aAAawB,MAAM,6DAQNN,YAChBA,cACMlB,aAAawB,MAAM,6BAGxBC,kBAAoB3B,UAAU4B,OAChC,qCAAsC,SAErClB,oBAAoBmB,UAAYF,sBAG3BG,MAAQ7B,KAAK8B,KAAK,CAAC,CACrBC,WAAY,2CACZC,KAAM,CACFC,UAAWvB,KAAKL,UAChB6B,WAAYf,WAIdgB,aAAeN,MAAM,IACrBO,KAAEA,KAAFC,UAAQA,WAAcF,OAEtBG,OAAS,QAAUC,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GACxDC,cAAgBzC,IAAI0C,WAAW,kBAAmB,8BAClDC,mBAAqB9C,UAAU4B,OACjC,sCACA,CACIgB,QAAAA,QACAG,OAAQH,QACRL,OAAAA,OACAF,KAAAA,KACAC,UAAAA,iBAGH5B,oBAAoBmB,UAAYiB,mBAE/BE,MAAQrC,KAAKD,oBAAoBD,cAAc,8BACjDuC,OACAA,MAAMnC,iBAAiB,SAASE,IAC5BA,EAAEG,sBACGO,mBAAmBL,WAGlC,MAAOM,aACCuB,gBAAkBjD,UAAU4B,OAC9B,mCAAoC,SAEnClB,oBAAoBmB,UAAYoB,UACrC/C,aAAagD,UAAUxB"}